!function(e,t){"function"==typeof define&&define.amd&&define([],t)}(this,function(){var e,t,n;!function(o){function r(e,t){return w.call(e,t)}function i(e,t){var n,o,r,i,a,u,c,s,f,l,p,d=t&&t.split("/"),g=k.map,h=g&&g["*"]||{};if(e&&"."===e.charAt(0))if(t){for(d=d.slice(0,d.length-1),e=e.split("/"),a=e.length-1,k.nodeIdCompat&&y.test(e[a])&&(e[a]=e[a].replace(y,"")),e=d.concat(e),f=0;f<e.length;f+=1)if(p=e[f],"."===p)e.splice(f,1),f-=1;else if(".."===p){if(1===f&&(".."===e[2]||".."===e[0]))break;f>0&&(e.splice(f-1,2),f-=2)}e=e.join("/")}else 0===e.indexOf("./")&&(e=e.substring(2));if((d||h)&&g){for(n=e.split("/"),f=n.length;f>0;f-=1){if(o=n.slice(0,f).join("/"),d)for(l=d.length;l>0;l-=1)if(r=g[d.slice(0,l).join("/")],r&&(r=r[o])){i=r,u=f;break}if(i)break;!c&&h&&h[o]&&(c=h[o],s=f)}!i&&c&&(i=c,u=s),i&&(n.splice(0,u,i),e=n.join("/"))}return e}function a(e,t){return function(){var n=x.call(arguments,0);return"string"!=typeof n[0]&&1===n.length&&n.push(null),d.apply(o,n.concat([e,t]))}}function u(e){return function(t){return i(t,e)}}function c(e){return function(t){v[e]=t}}function s(e){if(r(m,e)){var t=m[e];delete m[e],$[e]=!0,p.apply(o,t)}if(!r(v,e)&&!r($,e))throw new Error("No "+e);return v[e]}function f(e){var t,n=e?e.indexOf("!"):-1;return n>-1&&(t=e.substring(0,n),e=e.substring(n+1,e.length)),[t,e]}function l(e){return function(){return k&&k.config&&k.config[e]||{}}}var p,d,g,h,v={},m={},k={},$={},w=Object.prototype.hasOwnProperty,x=[].slice,y=/\.js$/;g=function(e,t){var n,o=f(e),r=o[0];return e=o[1],r&&(r=i(r,t),n=s(r)),r?e=n&&n.normalize?n.normalize(e,u(t)):i(e,t):(e=i(e,t),o=f(e),r=o[0],e=o[1],r&&(n=s(r))),{f:r?r+"!"+e:e,n:e,pr:r,p:n}},h={require:function(e){return a(e)},exports:function(e){var t=v[e];return"undefined"!=typeof t?t:v[e]={}},module:function(e){return{id:e,uri:"",exports:v[e],config:l(e)}}},p=function(e,t,n,i){var u,f,l,p,d,k,w=[],x=typeof n;if(i=i||e,"undefined"===x||"function"===x){for(t=!t.length&&n.length?["require","exports","module"]:t,d=0;d<t.length;d+=1)if(p=g(t[d],i),f=p.f,"require"===f)w[d]=h.require(e);else if("exports"===f)w[d]=h.exports(e),k=!0;else if("module"===f)u=w[d]=h.module(e);else if(r(v,f)||r(m,f)||r($,f))w[d]=s(f);else{if(!p.p)throw new Error(e+" missing "+f);p.p.load(p.n,a(i,!0),c(f),{}),w[d]=v[f]}l=n?n.apply(v[e],w):void 0,e&&(u&&u.exports!==o&&u.exports!==v[e]?v[e]=u.exports:l===o&&k||(v[e]=l))}else e&&(v[e]=n)},e=t=d=function(e,t,n,r,i){if("string"==typeof e)return h[e]?h[e](t):s(g(e,t).f);if(!e.splice){if(k=e,k.deps&&d(k.deps,k.callback),!t)return;t.splice?(e=t,t=n,n=null):e=o}return t=t||function(){},"function"==typeof n&&(n=r,r=i),r?p(o,e,t,n):setTimeout(function(){p(o,e,t,n)},4),d},d.config=function(e){return d(e)},e._defined=v,n=function(e,t,n){t.splice||(n=t,t=[]),r(v,e)||r(m,e)||(m[e]=[e,t,n])},n.amd={jQuery:!0}}(),n("../bower_components/almond/almond",function(){}),!function(){function e(e){return["$rootScope","$window",function(t,n){for(var o,r,i,a=n[e]||(console.warn("This browser does not support Web Storage!"),{}),u={$default:function(e){for(var t in e)angular.isDefined(u[t])||(u[t]=e[t]);return u},$reset:function(e){for(var t in u)"$"===t[0]||delete u[t];return u.$default(e)}},c=0;c<a.length;c++)(i=a.key(c))&&"ngStorage-"===i.slice(0,10)&&(u[i.slice(10)]=angular.fromJson(a.getItem(i)));return o=angular.copy(u),t.$watch(function(){r||(r=setTimeout(function(){if(r=null,!angular.equals(u,o)){angular.forEach(u,function(e,t){angular.isDefined(e)&&"$"!==t[0]&&a.setItem("ngStorage-"+t,angular.toJson(e)),delete o[t]});for(var e in o)a.removeItem("ngStorage-"+e);o=angular.copy(u)}},100))}),"localStorage"===e&&n.addEventListener&&n.addEventListener("storage",function(e){"ngStorage-"===e.key.slice(0,10)&&(e.newValue?u[e.key.slice(10)]=angular.fromJson(e.newValue):delete u[e.key.slice(10)],o=angular.copy(u),t.$apply())}),u}]}angular.module("ngStorage",[]).factory("$localStorage",e("localStorage")).factory("$sessionStorage",e("sessionStorage"))}(),n("ngstorage",function(){});angular.module("oauth",["oauth.directive","oauth.accessToken","oauth.endpoint","oauth.profile","oauth.interceptor"]);angular.module("oauth").config(["$locationProvider","$httpProvider",function(e,t){t.interceptors.push("ExpiredInterceptor")}]);var o=angular.module("oauth.accessToken",["ngStorage"]);o.factory("AccessToken",["$rootScope","$location","$sessionStorage","$interval",function(e,t,n,o){var r={token:null},i=["access_token","token_type","expires_in","scope","state","error","error_description"];r.get=function(){return this.token},r.set=function(){return this.setTokenFromString(t.hash()),null===r.token&&a(),this.token},r.destroy=function(){return delete n.token,this.token=null,this.token},r.expired=function(){return this.token&&this.token.expires_at&&this.token.expires_at<new Date},r.setTokenFromString=function(t){var n=c(t);n&&(p(),u(n),f(),e.$broadcast("oauth:login",r.token))};var a=function(){if(n.token){var e=n.token;e.expires_at=new Date(e.expires_at),u(e)}},u=function(e){return r.token=r.token||{},angular.extend(r.token,e),s(),l(),r.token},c=function(e){for(var t,n={},o=/([^&=]+)=([^&]*)/g;t=o.exec(e);)n[decodeURIComponent(t[1])]=decodeURIComponent(t[2]);return n.access_token||n.error?n:void 0},s=function(){n.token=r.token},f=function(){if(r.token){var e=new Date;e.setSeconds(e.getSeconds()+parseInt(r.token.expires_in)-60),r.token.expires_at=e}},l=function(){var t=new Date(r.token.expires_at)-new Date;t&&o(function(){e.$broadcast("oauth:expired",r.token)},t,1)},p=function(){var e=t.hash();angular.forEach(i,function(t){var n=new RegExp("&"+t+"(=[^&]*)?|^"+t+"(=[^&]*)?&?");e=e.replace(n,"")}),t.hash(e)};return r}]);var r=angular.module("oauth.endpoint",[]);r.factory("Endpoint",["AccessToken","$location",function(){var e,t={};return t.set=function(t){var n=t.scope?t.scope:"",o=t.state?encodeURIComponent(t.state):"",r=-1==t.authorizePath.indexOf("?")?!1:!0,i=r?"&":"?";return e=t.site+t.authorizePath+i+"response_type="+t.responseType+"&client_id="+encodeURIComponent(t.clientId)+"&redirect_uri="+encodeURIComponent(t.redirectUri)+"&scope="+n+"&state="+o},t.get=function(){return e},t.redirect=function(){window.location.replace(e)},t}]);var i=angular.module("oauth.profile",[]);i.factory("Profile",["$http","AccessToken","$rootScope",function(e,t,n){var o,r={};r.find=function(t){var r=e.get(t,{headers:i()});return r.success(function(e){o=e,n.$broadcast("oauth:profile",o)}),r},r.get=function(){return o},r.set=function(e){return o=e};var i=function(){return{Authorization:"Bearer "+t.get().access_token}};return r}]);var a=angular.module("oauth.interceptor",[]);a.factory("ExpiredInterceptor",["$rootScope","$q","$sessionStorage",function(e,t,n){var o={};o.request=function(t){var o=n.token;return o&&r(o)&&e.$broadcast("oauth:expired",o),t};var r=function(e){return e&&e.expires_at&&new Date(e.expires_at)<new Date};return o}]);var u=angular.module("oauth.directive",[]);return u.directive("oauth",["AccessToken","Endpoint","Profile","$location","$rootScope","$compile","$http","$templateCache",function(e,t,n,o,r,i,a,u){var c={restrict:"AE",replace:!0,scope:{site:"@",clientId:"@",redirectUri:"@",responseType:"@",scope:"@",profileUri:"@",template:"@",text:"@",authorizePath:"@",state:"@"}};return c.link=function(o,c){o.show="none",o.$watch("clientId",function(){s()});var s=function(){f(),l(),t.set(o),e.set(o),p(o),d()},f=function(){o.authorizePath=o.authorizePath||"/oauth/authorize",o.tokenPath=o.tokenPath||"/oauth/token",o.template=o.template||"bower_components/oauth-ng/dist/views/templates/default.html",o.responseType=o.responseType||"token",o.text=o.text||"Sign In",o.state=o.state||void 0,o.scope=o.scope||void 0},l=function(){a.get(o.template,{cache:u}).success(function(e){c.html(e),i(c.contents())(o)})},p=function(t){var o=e.get();o&&o.access_token&&t.profileUri&&n.find(t.profileUri).success(function(e){t.profile=e})},d=function(){var t=e.get();return t?t.access_token?g():t.error?v():void 0:h()};o.login=function(){t.redirect()},o.logout=function(){e.destroy(o),r.$broadcast("oauth:logout"),h()},o.$on("oauth:expired",function(){e.destroy(o),o.show="logged-out"});var g=function(){r.$broadcast("oauth:authorized",e.get()),o.show="logged-in"},h=function(){r.$broadcast("oauth:loggedOut"),o.show="logged-out"},v=function(){o.show="denied",r.$broadcast("oauth:denied")};o.$on("oauth:template:update",function(e,t){o.template=t,l(o)}),o.$on("$routeChangeSuccess",function(){s()})},c}]),n("oauth-ng",["angular","ngstorage"],function(){}),n("oauth-module",["angular","angular-ui-router","oauth-ng"],function(e){var t=e.module("predix.oauth",["ui.router","oauth"]).config(["$stateProvider",function(e){e.state("secure",{template:"<ui-view/>","abstract":!0,resolve:{token:["$q","$rootScope","AccessToken","Endpoint",function(e,t,n,o){var r=e.defer(),i=n.get();return i&&i.access_token?r.resolve(i):o.redirect(),r.promise}]}})}]);return t}),n("px-oauth-directive",["angular","./oauth-module","angular-ui-router","oauth-ng"],function(e,t){return t.directive("pxOauth",function(){return{scope:{site:"=",clientId:"=",redirectUri:"="},restrict:"AE",template:'<oauth ng-hide="true" site="{{site}}" client-id="{{clientId}}" redirect-uri="{{redirectUri}}"></oauth>'}}),t}),t(["./px-oauth-directive"],function(){}),n("main",function(){}),n("angular",[],function(){if(window.angular)return window.angular;throw new Error("Missing required dependency: vRuntime requires angular, please include angular to your application")}),n("angular-ui-router",[],function(){}),t("main")});
//# sourceMappingURL=px-oauth.min.js.map